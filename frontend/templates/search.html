<!DOCTYPE html>
<html lang="en">
<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta
			http-equiv="Cache-Control"
			content="no-cache, no-store, must-revalidate"
		/>
		<meta http-equiv="Pragma" content="no-cache" />
		<meta http-equiv="Expires" content="0" />
		<title>Enterprise Search Platform</title>
    <style>
        :root {
				--bg-primary: #0a0f1e;
				--bg-secondary: #111827;
				--bg-card: rgba(255, 255, 255, 0.04);
				--text-primary: #f9fafb;
				--text-secondary: #9ca3af;
				--text-muted: #6b7280;
				--accent-primary: #2563eb;
				--accent-secondary: #1d4ed8;
				--accent-tertiary: #0ea5e9;
				--border: rgba(255, 255, 255, 0.08);
				--border-strong: rgba(255, 255, 255, 0.15);
				--shadow: rgba(0, 0, 0, 0.4);
				--shadow-lg: rgba(0, 0, 0, 0.6);
				--success: #059669;
				--success-bg: rgba(5, 150, 105, 0.1);
				--warning: #d97706;
				--warning-bg: rgba(217, 119, 6, 0.1);
				--error: #dc2626;
				--error-bg: rgba(220, 38, 38, 0.1);
        }

        [data-theme="light"] {
				--bg-primary: #f8fafc;
				--bg-secondary: #ffffff;
				--bg-card: #ffffff;
				--text-primary: #0f172a;
				--text-secondary: #475569;
				--text-muted: #94a3b8;
				--accent-primary: #2563eb;
				--accent-secondary: #1d4ed8;
				--accent-tertiary: #0ea5e9;
				--border: rgba(15, 23, 42, 0.1);
				--border-strong: rgba(15, 23, 42, 0.2);
				--shadow: rgba(15, 23, 42, 0.08);
				--shadow-lg: rgba(15, 23, 42, 0.15);
				--success: #059669;
				--success-bg: rgba(5, 150, 105, 0.08);
				--warning: #d97706;
				--warning-bg: rgba(217, 119, 6, 0.08);
				--error: #dc2626;
				--error-bg: rgba(220, 38, 38, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
			transition: background 0.3s ease, color 0.3s ease;
			line-height: 1.6;
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
        }

        .theme-toggle {
            position: fixed;
			top: 1.5rem;
			right: 1.5rem;
            z-index: 1000;
            background: var(--bg-card);
            border: 1px solid var(--border);
			border-radius: 8px;
			padding: 0.625rem;
            cursor: pointer;
			transition: all 0.2s ease;
            backdrop-filter: blur(10px);
			box-shadow: 0 2px 8px var(--shadow);
        }

        .theme-toggle:hover {
			border-color: var(--border-strong);
			box-shadow: 0 4px 12px var(--shadow);
        }

        .theme-toggle svg {
            width: 24px;
            height: 24px;
            fill: var(--text-primary);
            transition: all 0.3s ease;
        }

        .container {
			max-width: 1440px;
            margin: 0 auto;
			padding: 0;
            min-height: 100vh;
        }

        .header {
            text-align: center;
			padding: 3.5rem 2rem 3rem;
			background: var(--bg-secondary);
			border-bottom: 1px solid var(--border);
			animation: slideDown 0.6s ease-out;
			box-shadow: 0 1px 3px var(--shadow);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
				transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

		.header-brand {
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 1rem;
			margin-bottom: 1.5rem;
		}

		.header-logo {
			width: 48px;
			height: 48px;
			background: linear-gradient(135deg, var(--accent-primary), var(--accent-tertiary));
			border-radius: 10px;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 24px;
            font-weight: 700;
			color: white;
			box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
		}

		.header h1 {
			font-size: 2.5rem;
			font-weight: 600;
			margin: 0;
			color: var(--text-primary);
			letter-spacing: -0.02em;
		}

		.header-subtitle {
            color: var(--text-secondary);
			font-size: 1.0625rem;
			max-width: 680px;
            margin: 0 auto;
			font-weight: 400;
			line-height: 1.5;
		}

		.main-content {
			padding: 2.5rem 2rem;
        }

        .back-btn {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border);
			padding: 0.625rem 1.25rem;
			border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
			font-size: 0.9375rem;
			transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
			gap: 0.625rem;
            margin-bottom: 2rem;
			box-shadow: 0 1px 3px var(--shadow);
        }

        .back-btn:hover {
			background: var(--bg-secondary);
			border-color: var(--border-strong);
			transform: translateX(-2px);
			box-shadow: 0 2px 8px var(--shadow);
        }

        .search-sections {
            display: grid;
            grid-template-columns: 1fr;
			gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .search-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
			border-radius: 12px;
			padding: 1.75rem;
			backdrop-filter: blur(10px);
			box-shadow: 0 2px 8px var(--shadow);
			animation: slideUp 0.6s ease-out;
			transition: all 0.2s ease;
		}

		.search-section:hover {
			border-color: var(--border-strong);
			box-shadow: 0 4px 16px var(--shadow);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
				transform: translateY(16px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .search-section h3 {
            color: var(--text-primary);
            margin-bottom: 1.5rem;
			font-size: 1.125rem;
			font-weight: 600;
            display: flex;
            align-items: center;
			gap: 0.625rem;
			letter-spacing: -0.01em;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            color: var(--text-secondary);
            font-weight: 500;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

			input,
			select {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

			input:focus,
			select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 16px;
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-card);
            margin: 1.5rem 0;
        }

        .upload-area:hover {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.05);
            transform: translateY(-2px);
        }

			.image-preview-container {
				position: relative;
				display: none;
				max-width: 400px;
				margin: 1rem auto;
			}

			.image-preview-container.active {
				display: block;
			}

			.image-preview {
				width: 100%;
				max-height: 300px;
				object-fit: contain;
				border-radius: 12px;
				border: 2px solid var(--border);
				background: var(--bg-card);
			}

			.clear-image-btn {
				position: absolute;
				top: -10px;
				right: -10px;
				width: 32px;
				height: 32px;
				border-radius: 50%;
				background: var(--error);
				color: white;
				border: 2px solid var(--bg);
				cursor: pointer;
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 1.2rem;
				font-weight: bold;
				transition: all 0.2s ease;
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
			}

			.clear-image-btn:hover {
				background: #dc2626;
				transform: scale(1.1);
			}

			.upload-area.has-image {
				padding: 1.5rem;
				cursor: default;
			}

			.upload-area.has-image:hover {
				transform: none;
        }

        .btn {
			background: var(--accent-primary);
            color: white;
            border: none;
			padding: 0.625rem 1.5rem;
			border-radius: 8px;
            font-weight: 600;
			font-size: 0.9375rem;
            cursor: pointer;
			transition: all 0.2s ease;
			box-shadow: 0 2px 8px rgba(37, 99, 235, 0.25);
        }

        .btn:hover {
			background: var(--accent-secondary);
			box-shadow: 0 4px 12px rgba(37, 99, 235, 0.35);
			transform: translateY(-1px);
		}

		.btn:active {
			transform: translateY(0);
			box-shadow: 0 2px 6px rgba(37, 99, 235, 0.25);
        }

        .btn:disabled {
			background: var(--text-muted);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
			opacity: 0.6;
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border);
			box-shadow: 0 2px 8px var(--shadow);
        }

        .btn-secondary:hover {
			background: var(--bg-secondary);
			border-color: var(--border-strong);
			box-shadow: 0 4px 12px var(--shadow);
        }

        .btn-warning {
			background: var(--warning);
			box-shadow: 0 2px 8px rgba(217, 119, 6, 0.25);
		}

		.btn-warning:hover {
			background: #b45309;
			box-shadow: 0 4px 12px rgba(217, 119, 6, 0.35);
		}

		.btn-success {
			background: var(--success);
			box-shadow: 0 2px 8px rgba(5, 150, 105, 0.25);
		}

		.btn-success:hover {
			background: #047857;
			box-shadow: 0 4px 12px rgba(5, 150, 105, 0.35);
        }

        .loading {
            text-align: center;
            padding: 3rem 2rem;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
				0%,
				100% {
					opacity: 1;
				}
				50% {
					opacity: 0.6;
				}
        }

        /* Circular Progress Indicator */
        .progress-circle {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 1.5rem;
        }

        .progress-circle svg {
            transform: rotate(-90deg);
        }

        .progress-circle-bg {
            fill: none;
            stroke: var(--border);
            stroke-width: 8;
        }

        .progress-circle-fill {
            fill: none;
            stroke: var(--accent-primary);
            stroke-width: 8;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.3s ease;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        @keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
        }

        .results-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            backdrop-filter: blur(20px);
            box-shadow: 0 16px 32px var(--shadow);
        }

        .result-item {
            background: var(--bg-card);
            border: 1px solid var(--border);
			border-radius: 12px;
            padding: 1.5rem;
			margin-bottom: 1.5rem;
			transition: all 0.2s ease;
            animation: slideInRight 0.5s ease-out;
			box-shadow: 0 2px 8px var(--shadow);
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
				transform: translateX(16px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .result-item:hover {
			border-color: var(--border-strong);
			box-shadow: 0 4px 16px var(--shadow);
        }

        .result-header {
			font-weight: 600;
			color: var(--text-primary);
            margin-bottom: 1rem;
			font-size: 1.125rem;
			letter-spacing: -0.01em;
        }

        .result-meta {
            color: var(--text-secondary);
			font-size: 0.875rem;
            margin-top: 0.5rem;
			line-height: 1.5;
		}

		.quiz-container {
			background: var(--bg-card);
			border: 1px solid var(--border-strong);
			border-radius: 12px;
			padding: 1.75rem;
			backdrop-filter: blur(10px);
			box-shadow: 0 4px 16px var(--shadow);
			animation: slideInUp 0.4s ease-out;
			margin-top: 2rem;
		}

		@keyframes slideInUp {
			from {
				opacity: 0;
				transform: translateY(16px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

			.quiz-question {
				background: var(--bg-secondary);
				border: 1px solid var(--border);
				border-radius: 12px;
				padding: 1.5rem;
				margin-bottom: 1.5rem;
			}

			.quiz-question h4 {
				color: var(--accent-primary);
				margin-bottom: 1rem;
				font-size: 1.1rem;
			}

			.quiz-options {
				display: flex;
				flex-wrap: wrap;
				gap: 0.75rem;
			}

			.quiz-option {
				background: var(--bg-card);
				border: 2px solid var(--border);
				border-radius: 8px;
				padding: 0.75rem 1.25rem;
				cursor: pointer;
				transition: all 0.2s ease;
				font-weight: 500;
			}

			.quiz-option:hover {
				border-color: var(--accent-primary);
				transform: scale(1.05);
			}

			.quiz-option.selected {
				background: var(--accent-primary);
				border-color: var(--accent-primary);
				color: white;
			}

			.match-badge {
				display: inline-block;
				background: var(--success);
				color: white;
				padding: 0.25rem 0.75rem;
				border-radius: 6px;
				font-size: 0.9rem;
				font-weight: 600;
				margin-left: 0.5rem;
        }

        .error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--error);
            color: var(--error);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1rem 0;
        }

        .no-results {
            text-align: center;
            color: var(--text-secondary);
            padding: 3rem 2rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            .header h1 {
                font-size: 2rem;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="theme-toggle" onclick="toggleTheme()">
        <svg class="sun-icon" viewBox="0 0 24 24">
				<circle cx="12" cy="12" r="5" />
				<path
					d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
				/>
        </svg>
    </div>

    <div class="container">
        <div class="header">
			<div class="header-brand">
				<div class="header-logo">S</div>
				<h1>Enterprise Search Platform</h1>
        </div>
			<p class="header-subtitle">
				Advanced AI-powered search with multi-modal capabilities, natural language processing, and intelligent document verification
			</p>
		</div>
		<div class="main-content">

        <a href="/" class="back-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
					<path
						d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"
					/>
            </svg>
            Back to Home
        </a>

        <div class="search-sections">
            <div class="search-section">
                <h3>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
							<path
								d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1L13.5 2.5L16.17 5.17L10.5 10.84L11.84 12.18L17.5 6.5L20.17 9.17L21 9ZM1 15H3L3.94 18.06L2.5 19.5L4.5 21.5L5.94 20.06L9 21H11V19L7.91 18.09L7 15H5.5L4.5 12H1V15Z"
							/>
                    </svg>
                    Natural Language Search
                </h3>
                <div class="form-row">
						<div class="form-group" style="grid-column: 1 / -1">
                        <label for="naturalQuery">Ask in plain English:</label>
							<input
								type="text"
								id="naturalQuery"
								placeholder="e.g., 'Find me a Pioneer CD player' or 'Show me gaming controllers'"
							/>
                    </div>
                </div>
					<button class="btn" onclick="searchByNaturalLanguage()">
						Search with AI
					</button>
            </div>

            <div class="search-section">
                <h3>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
							<path
								d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"
							/>
                    </svg>
                    Form-Based Search
                </h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="keywords">Keywords:</label>
							<input
								type="text"
								id="keywords"
								placeholder="Enter keywords..."
							/>
                    </div>
                    <div class="form-group">
                        <label for="color">Color:</label>
                        <select id="color">
                            <option value="">Any Color</option>
                            <option value="Red">Red</option>
                            <option value="Blue">Blue</option>
                            <option value="Green">Green</option>
                            <option value="Black">Black</option>
                            <option value="White">White</option>
                            <option value="Brown">Brown</option>
                            <option value="Gray">Gray</option>
                            <option value="Yellow">Yellow</option>
                            <option value="Orange">Orange</option>
                            <option value="Purple">Purple</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="material">Material:</label>
                        <select id="material">
                            <option value="">Any Material</option>
                            <option value="Leather">Leather</option>
                            <option value="Plastic">Plastic</option>
                            <option value="Metal">Metal</option>
                            <option value="Fabric">Fabric</option>
                            <option value="Denim">Denim</option>
                            <option value="Cotton">Cotton</option>
                            <option value="Wood">Wood</option>
                            <option value="Glass">Glass</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="condition">Condition:</label>
                        <select id="condition">
                            <option value="">Any Condition</option>
                            <option value="New">New</option>
                            <option value="Good">Good</option>
                            <option value="Used">Used</option>
                            <option value="Damaged">Damaged</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="category">Category:</label>
                        <select id="category">
                            <option value="">Any Category</option>
                            <option value="Electronics">Electronics</option>
                            <option value="Clothing">Clothing</option>
                            <option value="Accessories">Accessories</option>
                            <option value="Home">Home</option>
                            <option value="Sports">Sports</option>
                            <option value="Books">Books</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="nResults">Max Results:</label>
                        <select id="nResults">
                            <option value="5">5</option>
                            <option value="10">10</option>
                            <option value="20">20</option>
                        </select>
                    </div>
                </div>
					<button class="btn btn-secondary" onclick="searchByForm()">
						Search by Form
					</button>
            </div>

            <div class="search-section">
                <h3>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
							<path
								d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"
							/>
                    </svg>
                    Image Search
                </h3>
					<div id="uploadArea" class="upload-area" onclick="triggerFileInput()">
						<div id="uploadPrompt">
							<div
								style="
									width: 64px;
									height: 64px;
									margin: 0 auto 1rem;
									background: linear-gradient(
										135deg,
										var(--accent-primary),
										var(--accent-secondary)
									);
									border-radius: 16px;
									display: flex;
									align-items: center;
									justify-content: center;
								"
							>
								<svg
									viewBox="0 0 24 24"
									style="width: 32px; height: 32px; fill: white"
								>
									<path
										d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"
									/>
                        </svg>
                    </div>
							<p
								style="
									font-size: 1.1rem;
									margin-bottom: 0.5rem;
									color: var(--text-primary);
								"
							>
								<span id="uploadText"
									>Drop your image here or click to browse</span
								>
							</p>
							<p style="color: var(--text-secondary); font-size: 0.9rem">
                        Supports JPG, PNG, GIF, WebP ‚Ä¢ Max 10MB
                    </p>
                </div>
						<div id="previewContainer" class="image-preview-container">
							<img id="imagePreview" class="image-preview" alt="Preview" />
							<button
								class="clear-image-btn"
								onclick="clearImageSelection(event)"
								title="Remove image"
							>
								√ó
							</button>
						</div>
						<input
							type="file"
							id="searchFileInput"
							accept="image/*"
							style="display: none"
							onchange="handleSearchFileSelect(event)"
						/>
					</div>
					<button
						id="imageSearchBtn"
						class="btn"
						onclick="searchByImage()"
						disabled
					>
						Search by Image
					</button>
            </div>

			<!-- Magic Button Section -->
			<div class="search-section" style="background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(14, 165, 233, 0.08)); border: 1px solid var(--accent-primary);">
				<h3 style="color: var(--accent-primary);">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
						<path d="M17.75,4.09L15.22,6.03L16.13,9.09L13.5,7.28L10.87,9.09L11.78,6.03L9.25,4.09L12.44,4L13.5,1L14.56,4L17.75,4.09M21.25,11L19.61,12.25L20.2,14.23L18.5,13.06L16.8,14.23L17.39,12.25L15.75,11L17.81,10.95L18.5,9L19.19,10.95L21.25,11M18.97,15.95C19.8,15.87 20.69,17.05 20.16,17.8C19.84,18.25 19.5,18.67 19.08,19.07C15.17,23 8.84,23 4.94,19.07C1.03,15.17 1.03,8.83 4.94,4.93C5.34,4.53 5.76,4.17 6.21,3.85C6.96,3.32 8.14,4.21 8.06,5.04C7.79,7.9 8.75,10.87 10.95,13.06C13.14,15.26 16.1,16.22 18.97,15.95M17.33,17.97C14.5,17.81 11.7,16.64 9.53,14.5C7.36,12.31 6.2,9.5 6.04,6.68C3.23,9.82 3.34,14.64 6.35,17.66C9.37,20.67 14.19,20.78 17.33,17.97Z"/>
                    </svg>
					Quick Setup
                </h3>
				<p style="color: var(--text-secondary); margin-bottom: 1.5rem">
					One-click setup for new images: sync assets, generate AI descriptions, and create CLIP embeddings.
                </p>
				<button class="btn" onclick="processAllNewItems()" style="width: 100%; font-size: 1.05rem; padding: 1rem;">
					‚ú® Process All New Items
                </button>
            </div>

			<!-- Collapsible Data Management Section -->
			<details class="search-section" style="cursor: pointer;">
				<summary style="list-style: none; cursor: pointer;">
					<h3 style="display: inline-flex; align-items: center; gap: 0.625rem;">
						<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
							<path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.22,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
						</svg>
						Advanced Data Management
						<span style="font-size: 0.75rem; color: var(--text-muted); font-weight: 400;">(Click to expand)</span>
					</h3>
				</summary>
				
				<div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
					<!-- Individual Controls -->
					<div style="display: grid; gap: 1.5rem;">
						<!-- Sync Assets -->
						<div>
							<h4 style="font-size: 0.9375rem; margin-bottom: 0.5rem; color: var(--text-primary);">üìÅ Asset Sync</h4>
							<p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.75rem;">Scan for new images in the assets folder.</p>
							<button class="btn btn-success" onclick="syncAssets()" style="font-size: 0.875rem; padding: 0.625rem 1.25rem;">Sync New Images</button>
        </div>

						<!-- AI Descriptions -->
						<div>
							<h4 style="font-size: 0.9375rem; margin-bottom: 0.5rem; color: var(--text-primary);">üìù AI Text Descriptions</h4>
							<p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.75rem;">Generate detailed product descriptions using Watsonx AI.</p>
							<div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
								<button class="btn btn-warning" onclick="reprocessDescriptions(false)" style="font-size: 0.875rem; padding: 0.625rem 1.25rem;">Process New</button>
								<button class="btn" onclick="reprocessDescriptions(true)" style="background: var(--error); font-size: 0.875rem; padding: 0.625rem 1.25rem;">Force All</button>
							</div>
						</div>

						<!-- CLIP Embeddings -->
						<div>
							<h4 style="font-size: 0.9375rem; margin-bottom: 0.5rem; color: var(--text-primary);">üñºÔ∏è CLIP Image Embeddings</h4>
							<p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.75rem;">Create visual embeddings for image search.</p>
							<div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
								<button class="btn btn-warning" onclick="generateEmbeddings(false)" style="font-size: 0.875rem; padding: 0.625rem 1.25rem;">Generate New</button>
								<button class="btn" onclick="generateEmbeddings(true)" style="background: var(--error); font-size: 0.875rem; padding: 0.625rem 1.25rem;">Force All</button>
							</div>
						</div>

						<!-- Database Reload -->
						<div>
							<h4 style="font-size: 0.9375rem; margin-bottom: 0.5rem; color: var(--text-primary);">üîÑ Database Reload</h4>
							<p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.75rem;">Hot reload database after manual metadata edits.</p>
							<button class="btn btn-warning" onclick="reloadDatabase()" style="font-size: 0.875rem; padding: 0.625rem 1.25rem;">Reload from Disk</button>
						</div>
					</div>
				</div>
			</details>
		</div>

			<div id="loading" style="display: none">
            <div class="loading">
                <div class="progress-circle">
                    <svg width="120" height="120">
                        <circle class="progress-circle-bg" cx="60" cy="60" r="52"></circle>
                        <circle id="searchProgressCircleFill" class="progress-circle-fill" cx="60" cy="60" r="52" 
                                stroke-dasharray="326.73" stroke-dashoffset="326.73"></circle>
                    </svg>
                    <div class="progress-text" id="searchProgressText">0%</div>
                </div>
					<p id="searchLoadingStatus" style="color: var(--text-secondary)">
						Searching for similar items...
					</p>
					<p id="searchLoadingSubtext" style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 0.5rem;">
						Estimated time: ~10 seconds
					</p>
            </div>
        </div>

			<div id="results" class="results-container" style="display: none">
				<h3 style="margin-bottom: 1.5rem; color: var(--text-primary)">
					Search Results
				</h3>
            <div id="resultsList"></div>

				<!-- Refinement Quiz Button -->
				<div
					id="refineButtonContainer"
					style="display: none; margin-top: 2rem; text-align: center"
				>
					<button
						onclick="startRefinementQuiz()"
						style="
							background: linear-gradient(
								135deg,
								var(--accent-secondary),
								var(--accent-primary)
							);
							color: white;
							border: none;
							padding: 1rem 2rem;
							border-radius: 12px;
							font-size: 1rem;
							font-weight: 600;
							cursor: pointer;
							transition: all 0.3s ease;
							box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
						"
					>
						Refine Search Results
					</button>
					<p
						style="
							margin-top: 0.75rem;
							color: var(--text-secondary);
							font-size: 0.9rem;
						"
					>
						Answer questions to narrow down results and verify authenticity
					</p>
        </div>
    </div>

			<!-- Refinement Quiz Section -->
			<div id="quizSection" class="quiz-container" style="display: none">
				<h3 style="margin-bottom: 1.5rem; color: var(--text-primary)">
					Refine Search Results
				</h3>
				<p style="color: var(--text-secondary); margin-bottom: 2rem">
					Answer the questions you know to help narrow down results.
					<strong>Skip any you're unsure about!</strong>
				</p>

				<!-- Shipper/Consignee Question -->
				<div
					class="quiz-question"
					style="
						border: 2px solid var(--accent-primary);
						background: rgba(99, 102, 241, 0.05);
					"
				>
					<h4 style="color: var(--accent-primary)">
						Are you the shipper or consignee?
					</h4>
					<p
						style="
							color: var(--text-secondary);
							font-size: 0.9rem;
							margin: 0.5rem 0 1rem 0;
						"
					>
						Required for verification purposes
					</p>
					<div class="quiz-options">
						<div class="quiz-option" onclick="selectUserType('shipper', this)">
							Shipper (I'm sending the item)
						</div>
						<div
							class="quiz-option"
							onclick="selectUserType('consignee', this)"
						>
							Consignee (I'm receiving the item)
						</div>
					</div>
				</div>

				<div id="quizQuestions" style="margin-top: 1.5rem"></div>

				<div style="display: flex; gap: 1rem; margin-top: 2rem">
					<button
						onclick="submitQuizAnswers()"
						style="
							flex: 1;
							background: var(--success);
							color: white;
							border: none;
							padding: 1rem;
							border-radius: 12px;
							font-size: 1rem;
							font-weight: 600;
							cursor: pointer;
							transition: all 0.3s ease;
						"
					>
						Find My Item
					</button>
					<button
						onclick="cancelQuiz()"
						style="
							flex: 1;
							background: var(--bg-card);
							color: var(--text-primary);
							border: 1px solid var(--border);
							padding: 1rem;
							border-radius: 12px;
							font-size: 1rem;
							font-weight: 600;
							cursor: pointer;
							transition: all 0.3s ease;
						"
					>
						Cancel
					</button>
				</div>
			</div>

			<!-- Refined Results Section -->
			<div id="refinedResults" class="results-container" style="display: none">
				<!-- Verification Result at top -->
				<div
					id="verificationResult"
					style="display: none; margin-top: 2rem; margin-bottom: 2rem"
				>
					<div id="verificationMessage"></div>
				</div>

				<h3 style="margin-bottom: 1.5rem; color: var(--text-primary)">
					Refined Results (Ranked by Match)
				</h3>
				<div id="refinedResultsList"></div>
			</div>

			<!-- Invoice Verification Section (for shippers only) -->
			<div
				id="invoiceVerification"
				class="quiz-container"
				style="display: none"
			>
				<h3 style="margin-bottom: 1.5rem; color: var(--text-primary)">
					Invoice Verification
				</h3>
				<p style="color: var(--text-secondary); margin-bottom: 1.5rem">
					To verify this shipment and prevent fraud, please provide the invoice
					for the item in question.
				</p>

				<div
					class="upload-area"
					onclick="document.getElementById('invoiceFileInput').click()"
					style="margin-bottom: 1.5rem"
				>
					<div id="invoiceUploadPrompt">
						<div
							style="
								width: 64px;
								height: 64px;
								margin: 0 auto 1rem;
								background: linear-gradient(
									135deg,
									var(--accent-primary),
									var(--accent-secondary)
								);
								border-radius: 16px;
								display: flex;
								align-items: center;
								justify-content: center;
							"
						>
							<svg
								viewBox="0 0 24 24"
								style="width: 32px; height: 32px; fill: white"
							>
								<path
									d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"
								/>
							</svg>
						</div>
						<p
							style="
								font-size: 1.1rem;
								margin-bottom: 0.5rem;
								color: var(--text-primary);
							"
						>
							Upload Invoice (Optional)
						</p>
						<p style="color: var(--text-secondary); font-size: 0.9rem">
							JPG or PNG only ‚Ä¢ Max 10MB
						</p>
					</div>
					<div id="invoicePreviewContainer" class="image-preview-container">
						<img
							id="invoicePreview"
							class="image-preview"
							alt="Invoice Preview"
						/>
						<button
							class="clear-image-btn"
							onclick="clearInvoice(event)"
							title="Remove invoice"
						>
							√ó
						</button>
					</div>
					<input
						type="file"
						id="invoiceFileInput"
						accept="image/jpeg,image/png,image/jpg"
						style="display: none"
						onchange="handleInvoiceSelect(event)"
					/>
				</div>

				<div style="display: flex; gap: 1rem">
					<button
						id="verifyInvoiceBtn"
						onclick="submitInvoiceVerification(event)"
						style="
							flex: 1;
							background: var(--success);
							color: white;
							border: none;
							padding: 1rem;
							border-radius: 12px;
							font-size: 1rem;
							font-weight: 600;
							cursor: pointer;
						"
					>
						Verify Invoice
					</button>
					<button
						onclick="skipInvoiceVerification()"
						style="
							flex: 1;
							background: var(--bg-card);
							color: var(--text-primary);
							border: 1px solid var(--border);
							padding: 1rem;
							border-radius: 12px;
							font-size: 1rem;
							font-weight: 600;
							cursor: pointer;
						"
					>
						Skip Verification
					</button>
				</div>
			</div>
		</div>

		</div> <!-- End main-content -->
		</div> <!-- End container -->

    <script>
        let searchFile = null;
        
        // Theme toggle functionality
        function toggleTheme() {
            const html = document.documentElement;
				const currentTheme = html.getAttribute("data-theme");
				const newTheme = currentTheme === "light" ? "dark" : "light";
				html.setAttribute("data-theme", newTheme);
				localStorage.setItem("theme", newTheme);
        }

        // Load saved theme
			const savedTheme = localStorage.getItem("theme") || "dark";
			document.documentElement.setAttribute("data-theme", savedTheme);

			// Smart Progress Management
			let searchProgressInterval = null;
			function startSearchProgress(operation) {
				const timings = {naturalSearch: 10, quizGeneration: 15, invoiceVerify: 10};
				const totalTime = timings[operation] * 1000;
				const circle = document.getElementById('searchProgressCircleFill');
				const text = document.getElementById('searchProgressText');
				if (!circle || !text) return;
				
				if (searchProgressInterval) clearInterval(searchProgressInterval);
				let progress = 0;
				const interval = 100;
				const totalUpdates = totalTime / interval;
				let count = 0;
				
				searchProgressInterval = setInterval(() => {
					count++;
					const linear = count / totalUpdates;
					const eased = 1 - Math.pow(1 - linear, 3);
					progress = Math.min(Math.floor(eased * 99), 99);
					circle.style.strokeDashoffset = 326.73 - (progress / 100) * 326.73;
					text.textContent = progress + '%';
					if (progress >= 99) clearInterval(searchProgressInterval);
				}, interval);
			}

			async function completeSearchProgress() {
				if (searchProgressInterval) clearInterval(searchProgressInterval);
				const circle = document.getElementById('searchProgressCircleFill');
				const text = document.getElementById('searchProgressText');
				if (circle) circle.style.strokeDashoffset = 0;
				if (text) text.textContent = '100%';
				return new Promise(resolve => setTimeout(resolve, 300));
			}

			// Quiz Progress Management
			let quizProgressInterval = null;
			function startQuizProgress() {
				const totalTime = 15000; // 15 seconds
				const circle = document.getElementById('quizProgressCircleFill');
				const text = document.getElementById('quizProgressText');
				if (!circle || !text) return;
				
				if (quizProgressInterval) clearInterval(quizProgressInterval);
				let progress = 0;
				const interval = 100;
				const totalUpdates = totalTime / interval;
				let count = 0;
				
				quizProgressInterval = setInterval(() => {
					count++;
					const linear = count / totalUpdates;
					const eased = 1 - Math.pow(1 - linear, 3);
					progress = Math.min(Math.floor(eased * 99), 99);
					circle.style.strokeDashoffset = 326.73 - (progress / 100) * 326.73;
					text.textContent = progress + '%';
					if (progress >= 99) clearInterval(quizProgressInterval);
				}, interval);
			}

			async function completeQuizProgress() {
				if (quizProgressInterval) clearInterval(quizProgressInterval);
				const circle = document.getElementById('quizProgressCircleFill');
				const text = document.getElementById('quizProgressText');
				if (circle) circle.style.strokeDashoffset = 0;
				if (text) text.textContent = '100%';
				return new Promise(resolve => setTimeout(resolve, 300));
			}

			function triggerFileInput() {
				const previewContainer = document.getElementById("previewContainer");
				if (!previewContainer.classList.contains("active")) {
					document.getElementById("searchFileInput").click();
				}
			}
        
        function handleSearchFileSelect(event) {
            searchFile = event.target.files[0];
            if (searchFile) {
					// Validate file type
					if (!searchFile.type.startsWith("image/")) {
						alert("Please select an image file");
						return;
					}

					// Validate file size (10MB)
					if (searchFile.size > 10 * 1024 * 1024) {
						alert("Image size must be less than 10MB");
						return;
					}

					// Show preview
					const reader = new FileReader();
					reader.onload = function (e) {
						const preview = document.getElementById("imagePreview");
						const previewContainer =
							document.getElementById("previewContainer");
						const uploadPrompt = document.getElementById("uploadPrompt");
						const uploadArea = document.getElementById("uploadArea");

						preview.src = e.target.result;
						previewContainer.classList.add("active");
						uploadPrompt.style.display = "none";
						uploadArea.classList.add("has-image");

						document.getElementById("imageSearchBtn").disabled = false;
					};
					reader.readAsDataURL(searchFile);
				}
			}

			function clearImageSelection(event) {
				event.stopPropagation();

				// Reset file input
				document.getElementById("searchFileInput").value = "";
				searchFile = null;

				// Hide preview
				const preview = document.getElementById("imagePreview");
				const previewContainer = document.getElementById("previewContainer");
				const uploadPrompt = document.getElementById("uploadPrompt");
				const uploadArea = document.getElementById("uploadArea");

				preview.src = "";
				previewContainer.classList.remove("active");
				uploadPrompt.style.display = "block";
				uploadArea.classList.remove("has-image");

				document.getElementById("imageSearchBtn").disabled = true;
        }
        
        async function searchByNaturalLanguage() {
				console.log("searchByNaturalLanguage called");
				const naturalQuery = document
					.getElementById("naturalQuery")
					.value.trim();
				console.log("Natural query:", naturalQuery);
            
            if (!naturalQuery) {
					alert("Please enter a search query");
                return;
            }
            
            const formData = new FormData();
				formData.append("natural_query", naturalQuery);
				formData.append("n_results", document.getElementById("nResults").value);
            
            await performSearch(formData);
        }
        
        async function searchByForm() {
				console.log("searchByForm called");
            const formData = new FormData();
            
				const keywords = document.getElementById("keywords").value;
				const color = document.getElementById("color").value;
				const material = document.getElementById("material").value;
				const condition = document.getElementById("condition").value;
				const category = document.getElementById("category").value;
				const nResults = document.getElementById("nResults").value;

				console.log("Form values:", {
					keywords,
					color,
					material,
					condition,
					category,
					nResults,
				});

				if (keywords) formData.append("keywords", keywords);
				if (color) formData.append("color", color);
				if (material) formData.append("material", material);
				if (condition) formData.append("condition", condition);
				if (category) formData.append("category", category);
				formData.append("n_results", nResults);
            
            await performSearch(formData);
        }
        
        async function searchByImage() {
				console.log("searchByImage called");
            if (!searchFile) {
					console.log("No search file selected");
                return;
            }
				console.log("Search file:", searchFile.name);
            
            const formData = new FormData();
				formData.append("file", searchFile);
				formData.append("n_results", document.getElementById("nResults").value);
            
            await performSearch(formData);
        }
        
        async function performSearch(formData) {
				document.getElementById("loading").style.display = "block";
				document.getElementById("results").style.display = "none";
				startSearchProgress('naturalSearch'); // Start progress animation

				try {
					const response = await fetch("/api/search", {
						method: "POST",
						body: formData,
                });
                
                const result = await response.json();
                
					// Complete progress to 100%
					await completeSearchProgress();
					document.getElementById("loading").style.display = "none";
                
                if (result.success) {
                    displaySearchResults(result.results);
                } else {
                    displayError(result.error);
                }
            } catch (error) {
					await completeSearchProgress();
					document.getElementById("loading").style.display = "none";
					displayError("Network error: " + error.message);
            }
        }
        
        function displaySearchResults(results) {
				const resultsList = document.getElementById("resultsList");
            
            if (results.length === 0) {
					resultsList.innerHTML =
						'<div class="no-results">No matching items found.</div>';
            } else {
					resultsList.innerHTML = results
						.map((item, index) => {
                    // Construct image URL properly
							const imagePath = item.metadata.image_path || "";
							let imageUrl = "";
                    
                    if (imagePath) {
                        // Extract just the filename from the path
								const filename = imagePath.split("/").pop();
                        imageUrl = `/assets/${filename}`;
                    }
                    
                    return `
                    <div class="result-item" style="animation-delay: ${
											index * 0.1
										}s;">
                        <div style="display: flex; gap: 1.5rem; align-items: flex-start;">
                            <div style="flex-shrink: 0;">
                                ${
																	imageUrl
																		? `
                                    <img src="${imageUrl}" alt="${
																				item.metadata.title || item.id
																		  }" 
                                         style="width: 150px; height: 150px; object-fit: cover; border-radius: 12px; border: 2px solid var(--border);"
                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                    <div style="display: none; width: 150px; height: 150px; background: var(--bg-card); border-radius: 12px; border: 2px solid var(--border); align-items: center; justify-content: center; color: var(--text-secondary); font-size: 12px;">
                                        Image not available
                                    </div>
                                `
																		: `
                                    <div style="width: 150px; height: 150px; background: var(--bg-card); border-radius: 12px; border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; color: var(--text-secondary); font-size: 12px;">
                                        No image
                                    </div>
                                `
																}
                            </div>
                            <div style="flex: 1;">
                                <div class="result-header">Result ${
																	index + 1
																}: ${item.metadata.title || item.id}</div>
                                <p style="margin-bottom: 1rem; line-height: 1.5;"><strong>Description:</strong> ${
																	item.description
																}</p>
                                <div class="result-meta">
                                    <strong>Color:</strong> ${
																			item.metadata.color || "N/A"
																		} | 
                                    <strong>Material:</strong> ${
																			item.metadata.material || "N/A"
																		} | 
                                    <strong>Condition:</strong> ${
																			item.metadata.condition || "N/A"
																		} | 
                                    <strong>Category:</strong> ${
																			item.metadata.category || "N/A"
																		}
                                    ${
																			item.distance
																				? ` | <strong>Similarity:</strong> ${(
																						1 - item.distance
																				  ).toFixed(3)}`
																				: ""
																		}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
						})
						.join("");
				}

				document.getElementById("results").style.display = "block";

				// Auto-scroll to results section
				setTimeout(() => {
					document.getElementById("results").scrollIntoView({
						behavior: "smooth",
						block: "start",
					});
				}, 100);
        }
        
        function displayError(error) {
				const resultsList = document.getElementById("resultsList");
            resultsList.innerHTML = `<div class="error"><strong>Error:</strong> ${error}</div>`;
			document.getElementById("results").style.display = "block";
        }

		// Magic button - Process all new items at once
		async function processAllNewItems() {
			const confirmation = confirm(
				"‚ú® This will perform the following operations:\n\n" +
				"1. Sync new images from assets folder\n" +
				"2. Generate AI text descriptions for new items\n" +
				"3. Create CLIP embeddings for visual search\n\n" +
				"This may take several minutes.\n\nContinue?"
			);
			
			if (!confirmation) return;

			let totalAdded = 0;
			let totalDescriptions = 0;
			let totalEmbeddings = 0;

			try {
				// Step 1: Sync Assets
				alert("Step 1/3: Syncing new images from assets folder...");
				const syncResponse = await fetch("/api/sync-assets", { method: "POST" });
				const syncResult = await syncResponse.json();
				
				if (syncResult.success) {
					totalAdded = syncResult.added;
					if (totalAdded === 0) {
						alert("No new images found. Database is already up to date!");
						return;
					}
					alert(`‚úÖ Step 1/3 Complete: Found ${totalAdded} new image(s)`);
				} else {
					throw new Error(syncResult.error || "Sync failed");
				}

				// Step 2: Generate AI Descriptions
				alert("Step 2/3: Generating AI descriptions (this may take a while)...");
				const descFormData = new FormData();
				descFormData.append("force", false);
				const descResponse = await fetch("/api/reprocess-descriptions", { 
					method: "POST", 
					body: descFormData 
				});
				const descResult = await descResponse.json();
				
				if (descResult.success) {
					totalDescriptions = descResult.updated;
					alert(`‚úÖ Step 2/3 Complete: Generated ${totalDescriptions} AI description(s)`);
				} else {
					throw new Error(descResult.error || "Description generation failed");
				}

				// Step 3: Generate CLIP Embeddings
				alert("Step 3/3: Creating CLIP embeddings (this will take a few minutes)...");
				const embedFormData = new FormData();
				embedFormData.append("force", false);
				const embedResponse = await fetch("/api/generate-embeddings", { 
					method: "POST", 
					body: embedFormData 
				});
				const embedResult = await embedResponse.json();
				
				if (embedResult.success) {
					totalEmbeddings = embedResult.updated;
					alert(
						`üéâ All Done! Complete Setup Summary:\n\n` +
						`üìÅ New images synced: ${totalAdded}\n` +
						`üìù AI descriptions generated: ${totalDescriptions}\n` +
						`üñºÔ∏è CLIP embeddings created: ${totalEmbeddings}\n\n` +
						`Your database is now fully updated and ready for search!`
					);
				} else {
					throw new Error(embedResult.error || "Embedding generation failed");
				}

			} catch (error) {
				console.error("Process all error:", error);
				alert(`‚ùå Error during setup: ${error.message}\n\nSome steps may have completed successfully. Check individual tools in Advanced Data Management.`);
			}
		}

		async function reloadDatabase() {
            const button = event.target;
            const originalText = button.textContent;
            
            button.disabled = true;
				button.textContent = "üîÑ Reloading...";
				const originalBg = button.style.background;
				button.style.background = "var(--text-secondary)";
            
            try {
					const response = await fetch("/api/reload-database", {
						method: "POST",
                });
                
                const result = await response.json();
                
                if (result.success) {
						alert(
							`‚úÖ Database reloaded successfully!\n\nüìä Items: ${result.old_count} ‚Üí ${result.new_count}\n\nüíæ All changes from disk are now live!\n\nüîÑ Refresh the page (Cmd+R) to see updated data.`
						);
						// Auto-refresh the page to show new data
						setTimeout(() => window.location.reload(), 1000);
                } else {
						alert(`‚ùå Error: ${result.error}`);
                }
            } catch (error) {
					alert(`‚ùå Network error: ${error.message}`);
            } finally {
                button.disabled = false;
                button.textContent = originalText;
					button.style.background = originalBg;
				}
			}

			async function syncAssets() {
				const button = event.target;
				const originalText = button.textContent;

				button.disabled = true;
				button.textContent = "üîÑ Syncing...";
				const originalBg = button.style.background;
				button.style.background = "var(--text-secondary)";

				try {
					const response = await fetch("/api/sync-assets", {
						method: "POST",
					});

					const result = await response.json();

					if (result.success) {
						if (result.added > 0) {
							alert(
								`‚úÖ Synced successfully!\n\nüìÅ Found ${result.added} new image(s)\nüìä Total items: ${result.total}\n\nüí° Remember to click "Generate Embeddings" to enable CLIP search for new images!`
							);
						} else {
							alert(
								`‚úÖ Everything is in sync!\n\nüìä Total items: ${result.total}\nNo new images found in the assets folder.`
							);
						}
					} else {
						alert(`‚ùå Error: ${result.error}`);
					}
				} catch (error) {
					alert(`‚ùå Network error: ${error.message}`);
				} finally {
					button.disabled = false;
					button.textContent = originalText;
					button.style.background = originalBg;
				}
			}

			async function generateEmbeddings(forceRegenerate = false) {
				const button = event.target;
				const originalText = button.textContent;

				// Confirm if force regenerating
				if (forceRegenerate) {
					const confirmed = confirm(
						"‚ö†Ô∏è This will regenerate CLIP embeddings for ALL items.\n\nThis will take a few minutes as it loads the CLIP model and processes all images.\n\nContinue?"
					);
					if (!confirmed) return;
				}

				button.disabled = true;
				button.textContent = "üé® Processing...";
				const originalBg = button.style.background;
				button.style.background = "var(--text-secondary)";

				try {
					const formData = new FormData();
					formData.append("force", forceRegenerate);

					const response = await fetch("/api/generate-embeddings", {
						method: "POST",
						body: formData,
					});

					const result = await response.json();

					if (result.success) {
						if (result.force_regenerated) {
							alert(
								`‚úÖ Successfully regenerated CLIP embeddings for ${result.updated} items!\n\nüìä Total items: ${result.total}\n‚ö° Image search is now up to date!`
							);
						} else if (result.updated === 0 && result.already_processed > 0) {
							alert(
								`‚úÖ All ${result.total} items already have CLIP embeddings!\n\nNo items needed processing.\n\nüí° Tip: Use "Force Regenerate All" if you want to update embeddings.`
							);
						} else if (result.updated > 0) {
							alert(
								`‚úÖ Successfully generated CLIP embeddings for ${result.updated} item(s)!\n\nüìä Total items: ${result.total}\n‚úì Already had embeddings: ${result.already_processed}\n‚ö° Image search is now ready!`
							);
						} else {
							alert(`No items found to process. Total items: ${result.total}`);
						}
					} else {
						alert(`‚ùå Error: ${result.error}`);
					}
				} catch (error) {
					alert(`‚ùå Network error: ${error.message}`);
				} finally {
					button.disabled = false;
					button.textContent = originalText;
					button.style.background = originalBg;
				}
			}

			async function reprocessDescriptions(forceRegenerate = false) {
				const button = event.target;
				const originalText = button.textContent;

				// Confirm if force regenerating
				if (forceRegenerate) {
					const confirmed = confirm(
						"‚ö†Ô∏è This will regenerate AI descriptions for ALL items, even those that already have descriptions.\n\nThis may take several minutes and will use API credits.\n\nContinue?"
					);
					if (!confirmed) return;
				}

				button.disabled = true;
				button.textContent = "Processing...";
				const originalBg = button.style.background;
				button.style.background = "var(--text-secondary)";

				try {
					const formData = new FormData();
					formData.append("force", forceRegenerate);

					const response = await fetch("/api/reprocess-descriptions", {
						method: "POST",
						body: formData,
					});

					const result = await response.json();

					if (result.success) {
						if (result.force_regenerated) {
							alert(
								`‚úÖ Successfully regenerated ${result.updated} items with fresh AI descriptions!\n\nTotal items: ${result.total}`
							);
						} else if (result.updated === 0 && result.already_processed > 0) {
							alert(
								`‚úÖ All ${result.total} items already have AI descriptions!\n\nNo items needed to be processed.\n\nTip: Use "Force Regenerate All" to update existing descriptions.`
							);
						} else if (result.updated > 0) {
							alert(
								`‚úÖ Successfully updated ${result.updated} items with AI descriptions!\n\nTotal items: ${result.total}\nAlready processed: ${result.already_processed}`
							);
						} else {
							alert(`No items found to process. Total items: ${result.total}`);
						}
					} else {
						alert(`‚ùå Error: ${result.error}`);
					}
				} catch (error) {
					alert(`‚ùå Network error: ${error.message}`);
				} finally {
					button.disabled = false;
					button.textContent = originalText;
					button.style.background = originalBg;
				}
			}

			// Quiz Mode Variables
			let currentSearchResults = [];
			let quizQuestions = [];
			let quizAnswers = {};
			let userType = null; // 'shipper' or 'consignee'
			let invoiceFile = null;
			let topRefinedResult = null;

		// Modified displaySearchResults to show quiz button for multiple results
		const originalDisplaySearchResults = displaySearchResults;
		displaySearchResults = function (results) {
			currentSearchResults = results;
			
			// RESET ALL QUIZ STATE - Clear everything from previous refinement
			userType = null;
			invoiceFile = null;
			topRefinedResult = null;
			quizAnswers = {};
			quizQuestions = [];
			
			// Hide all quiz-related UI elements from previous search (with null checks)
			const quizSectionEl = document.getElementById("quizSection");
			if (quizSectionEl) quizSectionEl.style.display = "none";
			
			const refinedResultsEl = document.getElementById("refinedResults");
			if (refinedResultsEl) refinedResultsEl.style.display = "none";
			
			const invoiceVerificationEl = document.getElementById("invoiceVerification");
			if (invoiceVerificationEl) invoiceVerificationEl.style.display = "none";
			
			const verificationResultEl = document.getElementById("verificationResult");
			if (verificationResultEl) verificationResultEl.style.display = "none";
			
			// Clear quiz content to prevent stale data (with null check)
			const quizQuestionsEl = document.getElementById("quizQuestions");
			if (quizQuestionsEl) quizQuestionsEl.innerHTML = "";
			
			// Now show the new results
			originalDisplaySearchResults(results);

			// Show quiz button if we have 2+ results
			const refineButton = document.getElementById("refineButtonContainer");
			if (refineButton) {
				if (results.length >= 2) {
					refineButton.style.display = "block";
				} else {
					refineButton.style.display = "none";
				}
			}
		};

		async function startRefinementQuiz() {
			// SAFETY CHECK: Ensure we have valid search results
			if (!currentSearchResults || currentSearchResults.length < 2) {
				alert("‚ö†Ô∏è No search results available. Please perform a search first.");
				return;
			}

			// Clear old results
			document.getElementById("refinedResults").style.display = "none";
			if (document.getElementById("verificationResult")) {
				document.getElementById("verificationResult").style.display = "none";
			}
			document.getElementById("invoiceVerification").style.display = "none";

			// Reset variables
			userType = null;
			invoiceFile = null;
			topRefinedResult = null;
			quizAnswers = {};

			// Hide quiz button
			document.getElementById("refineButtonContainer").style.display = "none";

			// Show loading state
			const quizSection = document.getElementById("quizSection");
			quizSection.style.display = "block";
			document.getElementById("quizQuestions").innerHTML =
				`<div style="text-align: center; padding: 2rem;">
					<div class="progress-circle">
						<svg width="120" height="120">
							<circle class="progress-circle-bg" cx="60" cy="60" r="52"></circle>
							<circle id="quizProgressCircleFill" class="progress-circle-fill" cx="60" cy="60" r="52" 
									stroke-dasharray="326.73" stroke-dashoffset="326.73"></circle>
						</svg>
						<div class="progress-text" id="quizProgressText">0%</div>
					</div>
					<p style="color: var(--text-secondary); margin-top: 1rem;">Analyzing items and generating questions...</p>
					<p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 0.5rem;">Estimated: ~15 seconds</p>
				</div>`;
			
			// Start quiz progress
			startQuizProgress();

			// Scroll to quiz
			setTimeout(() => {
				quizSection.scrollIntoView({ behavior: "smooth", block: "start" });
			}, 100);

			try {
				// Get result IDs from current search results
				const resultIds = currentSearchResults.map((r) => r.id);
				
				console.log("Starting quiz for results:", resultIds); // Debug logging

					// Call API to generate questions
					const formData = new FormData();
					resultIds.forEach((id) => formData.append("result_ids", id));

					const response = await fetch("/api/generate-refinement-questions", {
						method: "POST",
						body: formData,
					});

					const result = await response.json();

					if (
						result.success &&
						result.questions &&
						result.questions.length > 0
					) {
						await completeQuizProgress();
						quizQuestions = result.questions;
						displayQuizQuestions(result.questions);
				} else {
					document.getElementById("quizQuestions").innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--error);">
                        <p>‚ùå Unable to generate questions. The items might be too similar.</p>
                        <p style="margin-top: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">Try using more specific search terms or filters.</p>
                        <button class="btn btn-secondary" onclick="cancelQuiz()" style="margin-top: 1rem;">‚Üê Back to Results</button>
                    </div>
                `;
				}
			} catch (error) {
				console.error("Quiz generation error:", error);
				document.getElementById("quizQuestions").innerHTML = `
                <div style="text-align: center; padding: 2rem; color: var(--error);">
                    <p>‚ùå Error: ${error.message}</p>
                    <p style="margin-top: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">Please try again or perform a new search.</p>
                    <button class="btn btn-secondary" onclick="cancelQuiz()" style="margin-top: 1rem;">‚Üê Back to Results</button>
                </div>
            `;
			}
		}

			function displayQuizQuestions(questions) {
				quizAnswers = {}; // Reset answers

				const questionsHTML = questions
					.map(
						(q, index) => `
                <div class="quiz-question">
                    <h4>${index + 1}. ${
							q.question
						} <span style="color: var(--text-secondary); font-weight: 400; font-size: 0.9rem;">(optional)</span></h4>
                    <div class="quiz-options">
                        ${q.options
													.map(
														(option) => `
                            <div class="quiz-option" 
                                 onclick="selectQuizOption('${q.field}', '${option}', this)"
                                 data-field="${q.field}" 
                                 data-value="${option}">
                                ${option}
                            </div>
                        `
													)
													.join("")}
                    </div>
                </div>
            `
					)
					.join("");

				document.getElementById("quizQuestions").innerHTML = questionsHTML;
			}

			function selectQuizOption(field, value, element) {
				// Remove 'selected' class from siblings
				const siblings = element.parentElement.querySelectorAll(".quiz-option");
				siblings.forEach((s) => s.classList.remove("selected"));

				// Add 'selected' class to clicked option
				element.classList.add("selected");

				// Store answer
				quizAnswers[field] = value;
			}

			async function submitQuizAnswers() {
				// Check if user type is selected
				if (!userType) {
					alert("‚ö†Ô∏è Please select whether you are a shipper or consignee");
					return;
				}

				// Check if at least ONE question is answered
				if (Object.keys(quizAnswers).length === 0) {
					alert(
						"‚ö†Ô∏è Please answer at least one question to refine your search."
					);
					return;
				}

				// Show loading
				document.getElementById("quizSection").innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <div class="loading-spinner"></div>
                    <p style="color: var(--text-secondary); margin-top: 1rem;">Finding your item...</p>
                </div>
            `;

				try {
					// Call API to refine search
					const formData = new FormData();
					currentSearchResults.forEach((r) =>
						formData.append("result_ids", r.id)
					);
					formData.append("answers", JSON.stringify(quizAnswers));

					const response = await fetch("/api/refine-search", {
						method: "POST",
						body: formData,
					});

					const result = await response.json();

					if (result.success) {
						// Hide quiz section
						document.getElementById("quizSection").style.display = "none";

						// Display refined results
						displayRefinedResults(result.results);
					} else {
						alert(`‚ùå Error: ${result.error}`);
						cancelQuiz();
					}
				} catch (error) {
					alert(`‚ùå Network error: ${error.message}`);
					cancelQuiz();
				}
			}

			function displayRefinedResults(results) {
				const refinedResultsList =
					document.getElementById("refinedResultsList");

				refinedResultsList.innerHTML = results
					.map((item, index) => {
						const imagePath = item.metadata.image_path || "";
						let imageUrl = "";

						if (imagePath) {
							const filename = imagePath.split("/").pop();
							imageUrl = `/assets/${filename}`;
						}

						// Determine badge color based on match percentage
						let badgeColor = "var(--success)";
						if (item.match_percentage < 50) badgeColor = "var(--error)";
						else if (item.match_percentage < 80) badgeColor = "var(--warning)";

						return `
                <div class="result-item" style="animation-delay: ${
									index * 0.1
								}s;">
                    <div style="display: flex; gap: 1.5rem; align-items: flex-start;">
                        <div style="flex-shrink: 0;">
                            ${
															imageUrl
																? `
                                <img src="${imageUrl}" alt="${
																		item.metadata.title || item.id
																  }" 
                                     style="width: 150px; height: 150px; object-fit: cover; border-radius: 12px; border: 2px solid var(--border);"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div style="display: none; width: 150px; height: 150px; background: var(--bg-card); border-radius: 12px; border: 2px solid var(--border); align-items: center; justify-content: center; color: var(--text-secondary); font-size: 12px;">
                                    Image not available
                                </div>
                            `
																: `
                                <div style="width: 150px; height: 150px; background: var(--bg-card); border-radius: 12px; border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; color: var(--text-secondary); font-size: 12px;">
                                    No image
                                </div>
                            `
														}
                        </div>
                        <div style="flex: 1;">
                            <div class="result-header">
                                ${index === 0 ? "üéØ " : ""}Result ${
							index + 1
						}: ${item.metadata.title || item.id}
                                <span style="background: ${badgeColor}; color: white; padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.9rem; font-weight: 600; margin-left: 0.5rem;">
                                    ${item.match_percentage}% Match
                                </span>
                            </div>
                            <p style="margin-bottom: 1rem; line-height: 1.5;"><strong>Description:</strong> ${
															item.description
														}</p>
                            <div class="result-meta">
                                <strong>Color:</strong> ${
																	item.metadata.color || "N/A"
																} | 
                                <strong>Material:</strong> ${
																	item.metadata.material || "N/A"
																} | 
                                <strong>Condition:</strong> ${
																	item.metadata.condition || "N/A"
																} | 
                                <strong>Category:</strong> ${
																	item.metadata.category || "N/A"
																}
                            </div>
                        </div>
                    </div>
                </div>
            `;
					})
					.join("");

				document.getElementById("refinedResults").style.display = "block";

				// Store top result for invoice verification
				if (results.length > 0) {
					topRefinedResult = results[0];
				}

				// If user is a shipper, show invoice verification
				if (userType === "shipper" && topRefinedResult) {
					// Hide refined results temporarily
					document.getElementById("refinedResults").style.display = "none";
					// Show invoice verification
					document.getElementById("invoiceVerification").style.display =
						"block";
					// Scroll to invoice verification
					setTimeout(() => {
						document.getElementById("invoiceVerification").scrollIntoView({
							behavior: "smooth",
							block: "start",
						});
					}, 100);
				} else {
					// For consignees, just show results
					// Scroll to refined results
					setTimeout(() => {
						document.getElementById("refinedResults").scrollIntoView({
							behavior: "smooth",
							block: "start",
						});
					}, 100);
				}
			}

			function cancelQuiz() {
				document.getElementById("quizSection").style.display = "none";
				document.getElementById("refineButtonContainer").style.display =
					"block";
				quizAnswers = {};
				userType = null;
			}

			function selectUserType(type, element) {
				// Remove 'selected' class from siblings
				const siblings = element.parentElement.querySelectorAll(".quiz-option");
				siblings.forEach((s) => s.classList.remove("selected"));

				// Add 'selected' class to clicked option
				element.classList.add("selected");

				// Store user type
				userType = type;
			}

			function handleInvoiceSelect(event) {
				invoiceFile = event.target.files[0];
				if (invoiceFile) {
					// Validate file type (ONLY images, no PDFs - Watsonx vision doesn't support PDFs)
					const validTypes = ["image/jpeg", "image/png", "image/jpg"];
					if (!validTypes.includes(invoiceFile.type)) {
						alert(
							"Please select a JPG or PNG image. PDFs are not supported by the AI vision model."
						);
						invoiceFile = null;
						document.getElementById("invoiceFileInput").value = "";
						return;
					}

					// Validate file size (10MB)
					if (invoiceFile.size > 10 * 1024 * 1024) {
						alert("File size must be less than 10MB");
						return;
					}

					// Show preview for images
					const reader = new FileReader();
					reader.onload = function (e) {
						document.getElementById("invoicePreview").src = e.target.result;
						document
							.getElementById("invoicePreviewContainer")
							.classList.add("active");
						document.getElementById("invoiceUploadPrompt").style.display =
							"none";
					};
					reader.readAsDataURL(invoiceFile);
				}
			}

			function clearInvoice(event) {
				event.stopPropagation();
				document.getElementById("invoiceFileInput").value = "";
				invoiceFile = null;
				document.getElementById("invoicePreview").src = "";
				document
					.getElementById("invoicePreviewContainer")
					.classList.remove("active");
				document.getElementById("invoiceUploadPrompt").style.display = "block";
			}

			async function submitInvoiceVerification(event) {
				if (!invoiceFile) {
					alert("‚ö†Ô∏è Please upload an invoice or click 'Skip Verification'");
					return;
				}

				// Show loading
				const button = event.target;
				button.disabled = true;
				button.textContent = "Verifying...";

				try {
					const formData = new FormData();
					formData.append("invoice", invoiceFile);
					formData.append("item_id", topRefinedResult.id);
					formData.append(
						"item_metadata",
						JSON.stringify(topRefinedResult.metadata)
					);

					const response = await fetch("/api/verify-invoice", {
						method: "POST",
						body: formData,
					});

					// Check HTTP status first
					if (!response.ok) {
						const errorText = await response.text();
						console.error("Server error:", errorText);
						throw new Error(
							`Server returned ${response.status}: ${response.statusText}`
						);
					}

					const result = await response.json();

					if (result.success) {
						showVerificationResult(result);
					} else {
						alert(`‚ùå Error: ${result.error || "Unknown error"}`);
					}
				} catch (error) {
					console.error("Invoice verification error:", error);
					alert(`‚ùå ${error.message || "Failed to verify invoice"}`);
				} finally {
					button.disabled = false;
					button.textContent = "Verify Invoice";
				}
			}

			function skipInvoiceVerification() {
				// Show refined results first
				document.getElementById("invoiceVerification").style.display = "none";
				document.getElementById("refinedResults").style.display = "block";

				// Scroll to results
				setTimeout(() => {
					document.getElementById("refinedResults").scrollIntoView({
						behavior: "smooth",
						block: "start",
					});
				}, 100);

				// Then show fraud warning below results
				setTimeout(() => {
					showVerificationResult({
						success: true,
						verification_skipped: true,
						match_status: "skipped",
						message: "Invoice verification was skipped",
					});
				}, 500);
			}

			function showVerificationResult(result) {
				// Hide invoice verification section
				document.getElementById("invoiceVerification").style.display = "none";

				// Keep refined results visible
				document.getElementById("refinedResults").style.display = "block";

				// Show verification result at top of refined results
				document.getElementById("verificationResult").style.display = "block";

				// Show result
				const verificationMessage = document.getElementById(
					"verificationMessage"
				);

				// Add parsing warning box if present
				let parsingWarningHTML = "";
				if (result.parsing_warning) {
					parsingWarningHTML = `
					<div style="background: rgba(245, 158, 11, 0.1); border: 2px solid var(--warning); border-radius: 12px; padding: 1rem; margin-bottom: 1rem;">
						<p style="color: var(--warning); margin: 0; display: flex; align-items: center; gap: 0.5rem;">
							<span>‚ö†Ô∏è</span>
							<strong>Warning:</strong> AI response parsing issue - ${result.parsing_warning}
						</p>
						<p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0.5rem 0 0 0;">
							The verification result may be less reliable. Manual review is recommended.
						</p>
					</div>
				`;
				}

				if (result.verification_skipped) {
					// Fraud warning for skipped verification
					verificationMessage.innerHTML =
						parsingWarningHTML +
						`
				<div style="background: rgba(239, 68, 68, 0.1); border: 2px solid var(--error); border-radius: 12px; padding: 1.5rem;">
					<h4 style="color: var(--error); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
						‚ö†Ô∏è Verification Skipped - Potential Fraud Risk
					</h4>
					<p style="color: var(--text-primary); margin-bottom: 1rem;">
						The shipper did not provide an invoice for verification. This could indicate potential fraud.
					</p>
					<p style="color: var(--text-secondary); font-size: 0.9rem;">
						<strong>Recommendation:</strong> Contact the shipper to request invoice documentation before proceeding with this shipment.
					</p>
				</div>
			`;
				} else if (result.match_status === "match") {
					// Invoice matches - good!
					verificationMessage.innerHTML =
						parsingWarningHTML +
						`
			<div style="background: rgba(16, 185, 129, 0.1); border: 2px solid var(--success); border-radius: 12px; padding: 1.5rem;">
				<h4 style="color: var(--success); margin-bottom: 1rem;">
					‚úì Invoice Verified - Likely Legitimate
				</h4>
				<p style="color: var(--text-primary); margin-bottom: 1rem;">
					${
						result.reasoning ||
						"The invoice matches the top result item. This shipment appears to be legitimate."
					}
				</p>
				<p style="color: var(--text-secondary); font-size: 0.9rem;">
					<strong>Match confidence:</strong> ${result.confidence || "High"} | 
					<strong>Invoice product:</strong> ${result.invoice_product || "N/A"}
				</p>
			</div>
		`;
				} else {
					// Invoice doesn't match - potential fraud (but lenient as requested)
					const warningLevel =
						result.match_status === "partial"
							? "Uncertain Match"
							: "Mismatch Detected";
					const warningColor =
						result.match_status === "partial"
							? "var(--warning)"
							: "var(--error)";
					const warningBg =
						result.match_status === "partial"
							? "rgba(245, 158, 11, 0.1)"
							: "rgba(239, 68, 68, 0.1)";

					verificationMessage.innerHTML =
						parsingWarningHTML +
						`
			<div style="background: ${warningBg}; border: 2px solid ${warningColor}; border-radius: 12px; padding: 1.5rem;">
				<h4 style="color: ${warningColor}; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
					‚ö†Ô∏è ${warningLevel} - Review Recommended
				</h4>
				<p style="color: var(--text-primary); margin-bottom: 1rem;">
					${result.reasoning || "The invoice does not clearly match the top result item."}
				</p>
				${
					result.discrepancies && result.discrepancies.length > 0
						? `
					<p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">
						<strong>Key differences noted:</strong>
					</p>
					<ul style="color: var(--text-secondary); font-size: 0.9rem; margin-left: 1.5rem; margin-bottom: 1rem;">
						${result.discrepancies.map((d) => `<li>${d}</li>`).join("")}
					</ul>
				`
						: ""
				}
				<p style="color: var(--text-secondary); font-size: 0.9rem;">
					<strong>Note:</strong> This mismatch could be due to ${
						result.confidence === "Very Low" ? "search refinement issues. " : ""
					}invoice discrepancies or different product naming conventions.
				</p>
				<p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 0.5rem;">
					<strong>Invoice product:</strong> ${result.invoice_product || "Unknown"}
				</p>
			</div>
		`;
				}

				// Scroll to refined results (which now has verification at top)
				setTimeout(() => {
					document.getElementById("refinedResults").scrollIntoView({
						behavior: "smooth",
						block: "start",
					});
				}, 100);
			}
    </script>
</body>
</html>
